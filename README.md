# MysticBot вЂ” Р­Р·РѕС‚РµСЂРёС‡РµСЃРєРёР№ Telegram-Р±РѕС‚ СЃ AI-СЂРµР¶РёРјРѕРј

Р‘РѕС‚ РґР»СЏ РїСЂРµРґСЃРєР°Р·Р°РЅРёР№, СЂР°СЃРєР»Р°РґРѕРІ РўР°СЂРѕ, РЅСѓРјРµСЂРѕР»РѕРіРёРё, РіРѕСЂРѕСЃРєРѕРїРѕРІ, С„РёРЅР°РЅСЃРѕРІРѕРіРѕ РєР°Р»РµРЅРґР°СЂСЏ Рё **AI-СЂРµР¶РёРјР°** СЃ РёРЅС‚РµРіСЂР°С†РёРµР№ Featherless API.

## Р’РѕР·РјРѕР¶РЅРѕСЃС‚Рё
- **РљР°СЂС‚С‹ РўР°СЂРѕ**: Р’РёСЂС‚СѓР°Р»СЊРЅС‹Рµ СЂР°СЃРєР»Р°РґС‹, РёРЅС‚РµСЂРїСЂРµС‚Р°С†РёСЏ
- **РҐРёСЂРѕРјР°РЅС‚РёСЏ**: РђРЅР°Р»РёР· С„РѕС‚РѕРіСЂР°С„РёР№ Р»Р°РґРѕРЅРё (CV)
- **РќСѓРјРµСЂРѕР»РѕРіРёСЏ**: Р Р°СЃС‡С‘С‚С‹ РїРѕ РґР°С‚Рµ СЂРѕР¶РґРµРЅРёСЏ, РёРјРµРЅРё
- **Р“РѕСЂРѕСЃРєРѕРїС‹**: Р•Р¶РµРґРЅРµРІРЅС‹Рµ, РЅРµРґРµР»СЊРЅС‹Рµ, РјРµСЃСЏС‡РЅС‹Рµ РїСЂРѕРіРЅРѕР·С‹
- **Р¤РёРЅР°РЅСЃРѕРІС‹Р№ РєР°Р»РµРЅРґР°СЂСЊ**: РђСЃС‚СЂРѕР»РѕРіРёС‡РµСЃРєРёРµ СЂРµРєРѕРјРµРЅРґР°С†РёРё РґР»СЏ С„РёРЅР°РЅСЃРѕРІ
- **РЎРѕРЅРЅРёРє**: РўРѕР»РєРѕРІР°РЅРёРµ СЃРЅРѕРІ
- **Р СѓРЅС‹**: Р“Р°РґР°РЅРёРµ РЅР° СЂСѓРЅР°С…
- **AI-СЂРµР¶РёРј**: Р”РёР°Р»РѕРі СЃ РР С‡РµСЂРµР· Featherless API (РјРѕРґРµР»СЊ DeepSeek-V3.2) СЃ РєРѕРЅС‚РµРєСЃС‚РѕРј Рё РєРЅРѕРїРєР°РјРё СѓРїСЂР°РІР»РµРЅРёСЏ

## РђСЂС…РёС‚РµРєС‚СѓСЂР° v2
- **Р”РІР° Р±РѕС‚Р°**: РѕСЃРЅРѕРІРЅРѕР№ РєР»РёРµРЅС‚СЃРєРёР№ Р±РѕС‚ (`bot/main.py`) Рё Р°РґРјРёРЅ-Р±РѕС‚ (`admin_bot.py`) РґР»СЏ СѓРїСЂР°РІР»РµРЅРёСЏ.
- **РњРѕРґСѓР»СЊРЅР°СЏ СЃС‚СЂСѓРєС‚СѓСЂР°**: РѕР±СЂР°Р±РѕС‚С‡РёРєРё РІ `bot/handlers/`, СЃРµСЂРІРёСЃС‹ РІ `bot/services/`, РєРѕРЅС„РёРіСѓСЂР°С†РёСЏ РІ `bot/config.py`.
- **РњСѓР»СЊС‚РёРїСЂРѕРІР°Р№РґРµСЂ LLM**: `bot/services/llm.py` РїРѕРґРґРµСЂР¶РёРІР°РµС‚ Featherless API, Perplexity API, OpenAI (fallbackвЂ‘С†РµРїРѕС‡РєР°).
- **SQLAlchemy + SQLite**: Р»РѕРєР°Р»СЊРЅР°СЏ Р±Р°Р·Р° РґР»СЏ РїРѕР»СЊР·РѕРІР°С‚РµР»РµР№ Рё FSM (СЃ РІРѕР·РјРѕР¶РЅРѕСЃС‚СЊСЋ РїРµСЂРµС…РѕРґР° РЅР° PostgreSQL).
- **Р¦РµРЅС‚СЂР°Р»РёР·РѕРІР°РЅРЅС‹Р№ Р·Р°РїСѓСЃРє**: СЃРєСЂРёРїС‚ `run_bots.py` Р·Р°РїСѓСЃРєР°РµС‚ РѕР±Р° Р±РѕС‚Р° РІ С„РѕРЅРѕРІРѕРј СЂРµР¶РёРјРµ (daemon).

## РЎС‚СЂСѓРєС‚СѓСЂР° РїСЂРѕРµРєС‚Р°
```
MysticBot/
в”њв”Ђв”Ђ bot/
в”‚   в”њв”Ђв”Ђ handlers/          # РћР±СЂР°Р±РѕС‚С‡РёРєРё РєРѕРјР°РЅРґ (ai_mode.py, start.py, astrology.py, вЂ¦)
в”‚   в”њв”Ђв”Ђ services/          # РЎРµСЂРІРёСЃС‹ (llm.py, daily_content.py, вЂ¦)
в”‚   в”њв”Ђв”Ђ database/          # SQLAlchemy engine, РјРѕРґРµР»Рё, РјРёРіСЂР°С†РёРё
в”‚   в”њв”Ђв”Ђ config.py          # DataclassвЂ‘РєРѕРЅС„РёРіСѓСЂР°С†РёСЏ (Р·Р°РјРµРЅСЏРµС‚ .env)
в”‚   в””в”Ђв”Ђ main.py            # РўРѕС‡РєР° РІС…РѕРґР° РѕСЃРЅРѕРІРЅРѕРіРѕ Р±РѕС‚Р°
в”њв”Ђв”Ђ admin_bot.py           # РђРґРјРёРЅ-Р±РѕС‚ (СѓРїСЂР°РІР»РµРЅРёРµ, РєРѕРЅСЃСѓР»СЊС‚Р°С†РёРё)
в”њв”Ђв”Ђ run_bots.py            # РЎРєСЂРёРїС‚ Р·Р°РїСѓСЃРєР° РґРІСѓС… Р±РѕС‚РѕРІ (--daemon, --stop, --status)
в”њв”Ђв”Ђ LAUNCH_GUIDE.md        # РџРѕРґСЂРѕР±РЅР°СЏ РёРЅСЃС‚СЂСѓРєС†РёСЏ РїРѕ РѕР±РЅРѕРІР»РµРЅРёСЋ Рё Р·Р°РїСѓСЃРєСѓ
в”њв”Ђв”Ђ requirements.txt       # Р—Р°РІРёСЃРёРјРѕСЃС‚Рё Python
в”њв”Ђв”Ђ .env.example           # РџСЂРёРјРµСЂ РїРµСЂРµРјРµРЅРЅС‹С… РѕРєСЂСѓР¶РµРЅРёСЏ
в”њв”Ђв”Ђ alembic.ini           # РќР°СЃС‚СЂРѕР№РєРё РјРёРіСЂР°С†РёР№
в”њв”Ђв”Ђ docker-compose.yml    # Docker Compose (РѕРїС†РёРѕРЅР°Р»СЊРЅРѕ)
в””в”Ђв”Ђ README.md
```

## Р‘С‹СЃС‚СЂС‹Р№ Р·Р°РїСѓСЃРє
```bash
# 1. РљР»РѕРЅРёСЂРѕРІР°С‚СЊ СЂРµРїРѕР·РёС‚РѕСЂРёР№
git clone <repo>
cd MysticBot

# 2. РЈСЃС‚Р°РЅРѕРІРёС‚СЊ Р·Р°РІРёСЃРёРјРѕСЃС‚Рё
pip install -r requirements.txt

# 3. РќР°СЃС‚СЂРѕРёС‚СЊ РєРѕРЅС„РёРіСѓСЂР°С†РёСЋ
cp .env.example .env
# РѕС‚СЂРµРґР°РєС‚РёСЂРѕРІР°С‚СЊ .env, РґРѕР±Р°РІРёС‚СЊ:
#   BOT_TOKEN=С‚РѕРєРµРЅ_РѕСЃРЅРѕРІРЅРѕРіРѕ_Р±РѕС‚Р°
#   ADMIN_BOT_TOKEN=С‚РѕРєРµРЅ_Р°РґРјРёРЅ_Р±РѕС‚Р°
#   FEATHERLESS_API_KEY=РєР»СЋС‡_featherless (РѕРїС†РёРѕРЅР°Р»СЊРЅРѕ)
#   PERPLEXITY_API_KEY=РєР»СЋС‡_perplexity (РѕРїС†РёРѕРЅР°Р»СЊРЅРѕ)

# 4. Р—Р°РїСѓСЃС‚РёС‚СЊ РѕР±Р° Р±РѕС‚Р° С‡РµСЂРµР· run_bots.py
python run_bots.py --daemon
```

## РЈРїСЂР°РІР»РµРЅРёРµ Р±РѕС‚Р°РјРё
```bash
# Р—Р°РїСѓСЃРє РІ С„РѕРЅРѕРІРѕРј СЂРµР¶РёРјРµ
python run_bots.py --daemon

# РћСЃС‚Р°РЅРѕРІРєР°
python run_bots.py --stop

# РЎС‚Р°С‚СѓСЃ
python run_bots.py --status

# Р›РѕРіРё
python run_bots.py --logs
```

## AI-СЂРµР¶РёРј
РџРѕР»СЊР·РѕРІР°С‚РµР»СЊ РјРѕР¶РµС‚ РІРѕР№С‚Рё РІ AI-СЂРµР¶РёРј РєРѕРјР°РЅРґРѕР№ `/ai` РёР»Рё РєРЅРѕРїРєРѕР№ В«рџ¤– РРвЂ‘СЂРµР¶РёРјВ». Р’ СЌС‚РѕРј СЂРµР¶РёРјРµ:
- Р’СЃРµ С‚РµРєСЃС‚РѕРІС‹Рµ СЃРѕРѕР±С‰РµРЅРёСЏ РѕС‚РїСЂР°РІР»СЏСЋС‚СЃСЏ РІ Featherless API (РјРѕРґРµР»СЊ DeepSeekвЂ‘V3.2, 32K РєРѕРЅС‚РµРєСЃС‚).
- РџРѕРґРґРµСЂР¶РёРІР°РµС‚СЃСЏ РёСЃС‚РѕСЂРёСЏ РґРёР°Р»РѕРіР° РІ РїСЂРµРґРµР»Р°С… СЃРµСЃСЃРёРё.
- РљРЅРѕРїРєРё В«рџ”„ РџРµСЂРµР·Р°РїСѓСЃС‚РёС‚СЊВ», В«рџ”® РЎРјРµРЅРёС‚СЊ С‚РµРјСѓВ», В«вќЊ Р’С‹Р№С‚РёВ» РґР»СЏ СѓРїСЂР°РІР»РµРЅРёСЏ.
- РђРІС‚РѕРјР°С‚РёС‡РµСЃРєРёР№ РІС‹С…РѕРґ РїРѕСЃР»Рµ 15 РјРёРЅСѓС‚ РЅРµР°РєС‚РёРІРЅРѕСЃС‚Рё.

## РРЅС‚РµРіСЂР°С†РёСЏ Featherless API
- РћСЃРЅРѕРІРЅРѕР№ РїСЂРѕРІР°Р№РґРµСЂ LLM вЂ” Featherless API СЃ РјРѕРґРµР»СЊСЋ `deepseek-ai/DeepSeek-V3.2`.
- FallbackвЂ‘С†РµРїРѕС‡РєР°: Featherless в†’ Perplexity в†’ OpenAI (РµСЃР»Рё РєР»СЋС‡Рё РЅР°СЃС‚СЂРѕРµРЅС‹).
- РўР°Р№РјР°СѓС‚С‹, retryвЂ‘Р»РѕРіРёРєР°, РєСЌС€РёСЂРѕРІР°РЅРёРµ.

## РљРѕРЅС„РёРіСѓСЂР°С†РёСЏ
- `BOT_TOKEN`: РўРѕРєРµРЅ РѕСЃРЅРѕРІРЅРѕРіРѕ Р±РѕС‚Р°
- `ADMIN_BOT_TOKEN`: РўРѕРєРµРЅ Р°РґРјРёРЅвЂ‘Р±РѕС‚Р°
- `FEATHERLESS_API_KEY`: РљР»СЋС‡ Featherless API (СЂРµРєРѕРјРµРЅРґСѓРµС‚СЃСЏ)
- `PERPLEXITY_API_KEY`: РљР»СЋС‡ Perplexity API (РѕРїС†РёРѕРЅР°Р»СЊРЅРѕ)
- `OPENAI_API_KEY`: РљР»СЋС‡ OpenAI API (РѕРїС†РёРѕРЅР°Р»СЊРЅРѕ)
- `DATABASE_URL`: PostgreSQL РїРѕРґРєР»СЋС‡РµРЅРёРµ (РїРѕ СѓРјРѕР»С‡Р°РЅРёСЋ SQLite)
- `REDIS_URL`: Redis РґР»СЏ РєСЌС€РёСЂРѕРІР°РЅРёСЏ Рё FSM (РїРѕ СѓРјРѕР»С‡Р°РЅРёСЋ memory storage)

## РћР±РЅРѕРІР»РµРЅРёРµ С„Р°Р№Р»РѕРІ СЃ Perplexity
РџСЂРё РїРѕР»СѓС‡РµРЅРёРё РЅРѕРІС‹С… РІРµСЂСЃРёР№ С„Р°Р№Р»РѕРІ (ai_mode.py, config.py, llm.py, engine.py, main.py) РѕС‚ Perplexity:
1. Р—Р°РјРµРЅРёС‚Рµ С„Р°Р№Р»С‹ РІ СЃРѕРѕС‚РІРµС‚СЃС‚РІСѓСЋС‰РёС… РїР°РїРєР°С….
2. РЈР±РµРґРёС‚РµСЃСЊ, С‡С‚Рѕ РІСЃРµ РІС‹Р·РѕРІС‹ `F.text.contains()` Р·Р°РјРµРЅРµРЅС‹ РЅР° `F.text ==`.
3. РџСЂРѕРІРµСЂСЊС‚Рµ СЃРёРЅС‚Р°РєСЃРёСЃ (Р»РёС€РЅРёРµ СЃРєРѕР±РєРё, Р·Р°РєСЂС‹РІР°СЋС‰РёРµ С‚РµРіРё).
4. Р—Р°РїСѓСЃС‚РёС‚Рµ `python run_bots.py --daemon`.

РџРѕРґСЂРѕР±РЅРµРµ РІ `LAUNCH_GUIDE.md`.

## Р›РёС†РµРЅР·РёСЏ
MIT